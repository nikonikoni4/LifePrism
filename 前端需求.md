# 一、Categorization 的Categoriy setting部分





# 二、timeoverview 部分
![alt text](image.png)

为了使 **Time Overview Widget** (包含饼图和堆叠柱状图) 能够正常渲染并支持“下钻 (Drill-down)”功能，后端接口需要返回动态的配置和数据。

我们需要一个统一的接口，根据是否传入 `parentId` (父分类ID) 来返回一级分类概览或二级分类详情。

## 1\. 接口定义

  * **Endpoint:** `GET /api/dashboard/time-overview` 
  * **Query Parameters:**
      * `date`: `YYYY-MM-DD` (e.g., `2023-10-25`)
      * `parentId`: `string` (可选。为空时返回一级分类概览；例如传入 `work` 时返回 Work 下的二级分类详情)

## 2\. 数据结构 (JSON Response)

这个结构直接对应前端 `TimeOverviewWidget` 渲染所需的三个核心部分：`pieData` (饼图数据)，`barData` (柱状图的时间轴数据)，和 `barKeys` (柱状图的键/颜色配置)。

### 场景 A: 一级分类概览 (`parentId` 为空)

```json
{
  "title": "Time Overview",
  "subTitle": "Activity breakdown & timeline",
  "totalTrackedMinutes": 780,
  
  // 1. 饼图数据 (Values in minutes)
  "pieData": [
    { "key": "work", "name": "Work/Study", "value": 480, "color": "#5B8FF9" },
    { "key": "entertainment", "name": "Entertainment", "value": 180, "color": "#FA8C16" },
    { "key": "other", "name": "Other", "value": 120, "color": "#BFBFBF" }
  ],

  // 2. 堆叠柱状图配置 (定义 Legend 和 堆叠顺序)
  "barKeys": [
    { "key": "work", "label": "Work", "color": "#5B8FF9" },
    { "key": "entertainment", "label": "Ent", "color": "#FA8C16" },
    { "key": "other", "label": "Other", "color": "#BFBFBF" }
  ],

  // 3. 24小时分布数据 (Key 必须与 barKeys 中的 key 对应)
  "barData": [
    { "timeRange": "0-2", "work": 0, "entertainment": 30, "other": 90 },
    { "timeRange": "2-4", "work": 0, "entertainment": 0, "other": 120 },
    // ... 省略中间的时间段
    { "timeRange": "8-10", "work": 120, "entertainment": 0, "other": 0 },
    // ... 直到 22-24
    { "timeRange": "22-24", "work": 0, "entertainment": 60, "other": 60 }
  ]
}
```

### 场景 B: 二级分类详情 (`parentId = "work"`)

```json
{
  "title": "Work Details",
  "subTitle": "Detailed breakdown & timeline",
  "totalTrackedMinutes": 480,

  // 1. 饼图数据 (变为二级分类)
  "pieData": [
    { "key": "coding", "name": "Coding", "value": 300, "color": "#5B8FF9" },
    { "key": "meeting", "name": "Meetings", "value": 100, "color": "#85A5FF" },
    { "key": "research", "name": "Research", "value": 80, "color": "#A5C5FF" }
  ],

  // 2. 堆叠柱状图配置 (Key 变为二级分类 ID)
  "barKeys": [
    { "key": "coding", "label": "Coding", "color": "#5B8FF9" },
    { "key": "meeting", "label": "Meeting", "color": "#85A5FF" },
    { "key": "research", "label": "Research", "color": "#A5C5FF" }
  ],

  // 3. 24小时分布数据
  "barData": [
    { "timeRange": "0-2", "coding": 0, "meeting": 0, "research": 0 },
    { "timeRange": "8-10", "coding": 60, "meeting": 40, "research": 0 },
    // ...
    { "timeRange": "16-18", "coding": 30, "meeting": 10, "research": 60 }
  ]
}
```

## 3\. TypeScript 定义 (Frontend)

你可以直接将这些类型用于前端 `types.ts`：

```typescript
export interface ChartSegment {
  key: string;      // ID, used for logic (e.g., 'work', 'coding')
  name: string;     // Display name (e.g., 'Work/Study', 'Coding')
  value: number;    // Duration in minutes
  color: string;    // Hex color code
}

export interface BarConfig {
  key: string;      // Matches the data key in TimeDistribution
  label: string;    // Legend label
  color: string;
}

export interface TimeDistribution {
  timeRange: string; // "0-2", "2-4"...
  [key: string]: string | number; // Dynamic keys (e.g., work: 120, coding: 60)
}

export interface TimeOverviewResponse {
  title: string;
  subTitle: string;
  totalTrackedMinutes: number;
  pieData: ChartSegment[];
  barKeys: BarConfig[];
  barData: TimeDistribution[];
}
```

## 4\. 为什么这样设计？

  * **前端零逻辑负担：** 前端不需要知道“Work”包含“Coding”。它只负责渲染 `barKeys` 里给它的东西。
  * **无限层级支持：** 虽然目前只有 2 级，但如果以后有 3 级分类，这个接口结构完全不需要变动，只需要换个 `parentId` 传进去。
  * **动态颜色：** 颜色由后端控制（基于 Categories 设置），保证了 Timeline、Categorization 和 Report 页面颜色的一致性。

-----

您对这个格式化后的文档还有其他修改或补充要求吗？